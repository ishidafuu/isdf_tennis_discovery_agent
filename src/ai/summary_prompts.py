"""
Summary Prompts for Tennis Discovery Agent

Generates prompts for Gemini AI to create summary pages.
"""

from datetime import datetime
from typing import Dict, List, Any


class SummaryPrompts:
    """ã¾ã¨ã‚ç”Ÿæˆç”¨ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ"""

    @staticmethod
    def generate_overview_prompt(data: Dict[str, Any]) -> str:
        """
        Generate prompt for ã¾ã¨ã‚_ç·åˆ.md.

        Args:
            data: Collected memo data

        Returns:
            Prompt string for Gemini API
        """
        today = datetime.now().strftime('%Y-%m-%d')

        return f"""
ã‚ãªãŸã¯ãƒ†ãƒ‹ã‚¹ã‚³ãƒ¼ãƒã®ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã§ã™ã€‚
ä»¥ä¸‹ã®ãƒ†ãƒ‹ã‚¹ç·´ç¿’ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰ã€ç·´ç¿’å‰ãƒã‚§ãƒƒã‚¯ç”¨ã®ã¾ã¨ã‚ã‚’ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚

# ãƒ‡ãƒ¼ã‚¿

## æœªè§£æ±ºã®åçœç‚¹
{SummaryPrompts._format_reflections(data['reflections'])}

## æœ€è¿‘ã®æ°—ã¥ãï¼ˆç›´è¿‘10ä»¶ï¼‰
{SummaryPrompts._format_insights(data['insights'][:10])}

## ã‚¿ã‚°åˆ¥é›†è¨ˆ
{SummaryPrompts._format_tags(data['tags'])}

## ãƒˆãƒ¬ãƒ³ãƒ‰æƒ…å ±
{SummaryPrompts._format_trends(data.get('trends', {}))}

# ã‚¿ã‚¹ã‚¯

ç·´ç¿’å‰ã«è¦‹ã¦ã€ä»Šæ—¥ã®ç·´ç¿’ã§æ„è­˜ã™ã¹ããƒã‚¤ãƒ³ãƒˆãŒæ˜ç¢ºã«ãªã‚‹ã¾ã¨ã‚ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚

# å‡ºåŠ›å½¢å¼

ä»¥ä¸‹ã®Markdownå½¢å¼ã§å‡ºåŠ›ã—ã¦ãã ã•ã„ï¼š

```markdown
# ãƒ†ãƒ‹ã‚¹ç·´ç¿’ã¾ã¨ã‚ï¼ˆç·åˆï¼‰

æœ€çµ‚æ›´æ–°: {today}

---

## ğŸš¨ ç·´ç¿’å‰ãƒã‚§ãƒƒã‚¯

### ä»Šæ—¥æ„è­˜ã™ã‚‹ã“ã¨ï¼ˆæœªè§£æ±ºã®åçœç‚¹ï¼‰

æœªè§£æ±ºã®åçœç‚¹ã‚’å„ªå…ˆåº¦é †ã«3-5ä»¶è¡¨ç¤ºã—ã¦ãã ã•ã„ã€‚
- ç¹°ã‚Šè¿”ã—ç™ºç”Ÿã—ã¦ã„ã‚‹åçœç‚¹ã‚’ä¸Šä½ã«
- ãã‚Œãã‚Œã«å…·ä½“çš„ãªå¯¾ç­–ã‚’æ·»ãˆã¦ãã ã•ã„

ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ:
- [ ] [æŠ€è¡“å]: [åçœå†…å®¹] â†’ [å…·ä½“çš„ãªå¯¾ç­–]
  [è£œè¶³èª¬æ˜ï¼ˆã‚ã‚Œã°ï¼‰]

### æœ€è¿‘ã†ã¾ãã„ã£ã¦ã„ã‚‹ã“ã¨

ç›´è¿‘2é€±é–“ã§æˆåŠŸã—ãŸæ°—ã¥ãã‚’3-5ä»¶è¡¨ç¤ºã—ã¦ãã ã•ã„ã€‚
- ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ãŒä¸ŠãŒã‚‹ã‚ˆã†ãªè¡¨ç¾ã§

ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ:
- âœ… [æŠ€è¡“å]ãƒ»[ã‚·ãƒ§ãƒƒãƒˆç¨®åˆ¥]: [æ°—ã¥ã]
  [åŠ±ã¾ã—ã®è¨€è‘‰ï¼ˆã€Œã“ã®èª¿å­ã§ï¼ã€ãªã©ï¼‰]

---

## ğŸ“Š æœ€è¿‘ã®ãƒˆãƒ¬ãƒ³ãƒ‰ï¼ˆéå»2é€±é–“ï¼‰

### é »å‡ºã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰

ãƒˆãƒ¬ãƒ³ãƒ‰æƒ…å ±ã‹ã‚‰ã€ä»¥ä¸‹ã‚’åˆ†æã—ã¦ãã ã•ã„:
- é »å‡ºã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ä¸Šä½3ã¤
- ãã‚Œãã‚Œã«å¯¾ã—ã¦ã€Œç¶™ç¶šã™ã¹ãã€ã¾ãŸã¯ã€Œæ”¹å–„ã™ã¹ãã€ã®ã‚¢ãƒ‰ãƒã‚¤ã‚¹

ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ:
- ã€Œ[ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰]ã€ãŒ[å›æ•°]å› â†’ [è§£é‡ˆã¨ã‚¢ãƒ‰ãƒã‚¤ã‚¹]

ä¾‹:
- ã€Œæ—©ã‚ã®æº–å‚™ã€ãŒ3å› â†’ æ„è­˜ã§ãã¦ã„ã‚‹è¨¼æ‹ ã§ã™ï¼ç¶™ç¶šã—ã¾ã—ã‚‡ã†ã€‚
- ã€ŒåŠ›ã¿ã™ãã€ã®åçœãŒ2å› â†’ ä»Šé€±ã¯ãƒªãƒ©ãƒƒã‚¯ã‚¹ã‚’é‡ç‚¹çš„ã«ã€‚
  å…·ä½“çš„ã«ã¯ã€ã‚°ãƒªãƒƒãƒ—ã‚’ç·©ãæŒã¤ã“ã¨ã‹ã‚‰å§‹ã‚ã¦ã¿ã¦ãã ã•ã„ã€‚

### æŠ€è¡“åˆ¥ã®æ°—ã¥ãé »åº¦

ã‚¿ã‚°åˆ¥é›†è¨ˆã‹ã‚‰ã€ä¸Šä½5ã¤ã‚’è¡¨ç¤ºã—ã¦ãã ã•ã„ã€‚

ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ:
- [æŠ€è¡“å]: [ä»¶æ•°]

---

## ğŸ“š è©³ç´°ã¾ã¨ã‚ã¸ã®ãƒªãƒ³ã‚¯

### æœŸé–“åˆ¥
- [[ã¾ã¨ã‚_æœ€è¿‘]] - ç›´è¿‘2é€±é–“ã®è©³ç´°
- [[ã¾ã¨ã‚_1ãƒ¶æœˆ]] - éå»1ãƒ¶æœˆã®è©³ç´°

### æŠ€è¡“åˆ¥
- [[ã¾ã¨ã‚_ãƒ•ã‚©ã‚¢ãƒãƒ³ãƒ‰]] - ãƒ•ã‚©ã‚¢ãƒãƒ³ãƒ‰å…¨è¨˜éŒ²
- [[ã¾ã¨ã‚_ãƒãƒƒã‚¯ãƒãƒ³ãƒ‰]] - ãƒãƒƒã‚¯ãƒãƒ³ãƒ‰å…¨è¨˜éŒ²
- [[ã¾ã¨ã‚_ã‚µãƒ¼ãƒ–]] - ã‚µãƒ¼ãƒ–å…¨è¨˜éŒ²
```

# æ³¨æ„äº‹é …

1. **è‡ªç„¶ãªæ—¥æœ¬èª**: æ©Ÿæ¢°çš„ã«ãªã‚‰ãšã€ã‚³ãƒ¼ãƒãŒè©±ã™ã‚ˆã†ãªæ¸©ã‹ã¿ã®ã‚ã‚‹è¡¨ç¾
2. **å…·ä½“çš„ãªã‚¢ãƒ‰ãƒã‚¤ã‚¹**: ã€Œæ„è­˜ã—ã¾ã—ã‚‡ã†ã€ã ã‘ã§ãªãã€ã€Œã©ã†ã™ã‚Œã°è‰¯ã„ã‹ã€ã‚’æ˜ç¤º
3. **ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³**: æˆåŠŸä½“é¨“ã‚’å¼·èª¿ã—ã€å‰å‘ããªæ°—æŒã¡ã«ãªã‚Œã‚‹ã‚ˆã†ã«
4. **å„ªå…ˆé †ä½**: é‡è¦åº¦ãƒ»ç·Šæ€¥åº¦ã®é«˜ã„ã‚‚ã®ã‚’ä¸Šä½ã«
5. **èª­ã¿ã‚„ã™ã•**: ç®‡æ¡æ›¸ãã€çµµæ–‡å­—ã‚’æ´»ç”¨

ãã‚Œã§ã¯ã€ã¾ã¨ã‚ã‚’ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚
"""

    @staticmethod
    def generate_technique_prompt(data: Dict[str, Any], technique: str) -> str:
        """
        Generate prompt for technique-based summary.

        Args:
            data: Collected memo data
            technique: Technique name (ãƒ•ã‚©ã‚¢ãƒãƒ³ãƒ‰, ãƒãƒƒã‚¯ãƒãƒ³ãƒ‰, ã‚µãƒ¼ãƒ–)

        Returns:
            Prompt string for Gemini API
        """
        today = datetime.now().strftime('%Y-%m-%d')

        return f"""
ã‚ãªãŸã¯ãƒ†ãƒ‹ã‚¹ã‚³ãƒ¼ãƒã®ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã§ã™ã€‚
ä»¥ä¸‹ã®{technique}ã«é–¢ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰ã€æŠ€è¡“åˆ¥ã¾ã¨ã‚ã‚’ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚

# ãƒ‡ãƒ¼ã‚¿

## æ°—ã¥ãï¼ˆå…¨æœŸé–“ï¼‰
{SummaryPrompts._format_insights(data['insights'])}

## åçœç‚¹ï¼ˆæœªè§£æ±ºï¼‰
{SummaryPrompts._format_reflections(data['reflections'])}

## ã‚¿ã‚°åˆ¥é›†è¨ˆ
{SummaryPrompts._format_tags(data['tags'])}

# ã‚¿ã‚¹ã‚¯

{technique}ã®å…¨è¨˜éŒ²ã‚’ã€ã‚·ãƒ§ãƒƒãƒˆç¨®åˆ¥ã”ã¨ã«æ•´ç†ã—ã¦ã¾ã¨ã‚ã¦ãã ã•ã„ã€‚

# å‡ºåŠ›å½¢å¼

```markdown
# {technique}ã¾ã¨ã‚

æœ€çµ‚æ›´æ–°: {today}

---

## ğŸ¾ å…¨ä½“çš„ãªå‚¾å‘

ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰èª­ã¿å–ã‚Œã‚‹{technique}ã®å‚¾å‘ã‚’2-3æ–‡ã§è¦ç´„ã—ã¦ãã ã•ã„ã€‚
ä¾‹:
- å¼·æ‰“ã®ç²¾åº¦ãŒå‘ä¸Šã—ã¦ã„ã‚‹
- ã‚¹ãƒ©ã‚¤ã‚¹ã®ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã«èª²é¡ŒãŒã‚ã‚‹
- ä¸å¯§æ‰“ã¡ã¯å®‰å®šã—ã¦ããŸ

---

## ğŸ’¡ æ°—ã¥ãï¼ˆæ™‚ç³»åˆ—ï¼‰

{technique}ã«é–¢ã™ã‚‹æ°—ã¥ãã‚’æ™‚ç³»åˆ—ã§è¡¨ç¤ºã—ã¦ãã ã•ã„ã€‚
- æ·±å €ã‚Šæƒ…å ±ï¼ˆå¯¾æ¯”ã€æ ¹æ‹ ãªã©ï¼‰ã‚‚å«ã‚ã¦
- ã‚·ãƒ§ãƒƒãƒˆç¨®åˆ¥ãŒã‚ã‹ã‚‹å ´åˆã¯æ˜è¨˜

ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ:
- **[æ°—ã¥ãã®è¦ç´„]**ï¼ˆ[æ—¥ä»˜]ï¼‰
  - ã‚·ãƒ§ãƒƒãƒˆ: [å¼·æ‰“ / ä¸å¯§ / ã‚¹ãƒ©ã‚¤ã‚¹ / ä¸æ˜]
  - ğŸ’¡ è©³ç´°: [æ°—ã¥ãã®è©³ç´°]
  - ğŸ’¡ å¯¾æ¯”: [å¯¾æ¯”æƒ…å ±ï¼ˆã‚ã‚Œã°ï¼‰]
  - ğŸ’¡ æ ¹æ‹ : [æ ¹æ‹ æƒ…å ±ï¼ˆã‚ã‚Œã°ï¼‰]

---

## âš ï¸ åçœç‚¹ï¼ˆæœªè§£æ±ºï¼‰

æœªè§£æ±ºã®åçœç‚¹ã‚’è¡¨ç¤ºã—ã¦ãã ã•ã„ã€‚
- ç¹°ã‚Šè¿”ã—ç™ºç”Ÿã—ã¦ã„ã‚‹å ´åˆã¯æ—¥ä»˜ã‚’è¤‡æ•°è¡¨ç¤º

ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ:
- [ ] [åçœå†…å®¹]
  - åŸå› : [æ¨æ¸¬ã•ã‚Œã‚‹åŸå› ]
  - å¯¾ç­–: [è©¦ã™ã¹ãå¯¾ç­–]

---

## ğŸ“Š çµ±è¨ˆ

- å…¨æ°—ã¥ãä»¶æ•°: [ä»¶æ•°]
- æœªè§£æ±ºã®åçœç‚¹: [ä»¶æ•°]
- è¨˜éŒ²æœŸé–“: {data['date_range']['start']} ã€œ {data['date_range']['end']}

---

## ğŸ¯ æ¬¡ã«æ„è­˜ã™ã‚‹ã“ã¨

{technique}ã«é–¢ã—ã¦ã€æ¬¡ã®ç·´ç¿’ã§æ„è­˜ã™ã¹ãã“ã¨ã‚’2-3å€‹ææ¡ˆã—ã¦ãã ã•ã„ã€‚
- æœªè§£æ±ºã®åçœç‚¹ã‹ã‚‰å„ªå…ˆåº¦ã®é«˜ã„ã‚‚ã®
- æœ€è¿‘ã®æˆåŠŸä½“é¨“ã‚’ä¼¸ã°ã™æ–¹å‘æ€§
```

# æ³¨æ„äº‹é …

1. **æ™‚ç³»åˆ—**: æ°—ã¥ãã¯æ—¥ä»˜é †ã«ä¸¦ã¹ã‚‹
2. **æ·±å €ã‚Šæƒ…å ±**: å¯¾æ¯”ã€æ ¹æ‹ ãªã©ãŒã‚ã‚Œã°å¿…ãšå«ã‚ã‚‹
3. **åçœç‚¹ã®è¿½è·¡**: åŒã˜å†…å®¹ã®åçœãŒè¤‡æ•°å›å‡ºã¦ã„ã‚‹å ´åˆã¯æ˜ç¤º
4. **çµ±è¨ˆ**: æ•°å€¤ã§æŒ¯ã‚Šè¿”ã‚ŠãŒã§ãã‚‹ã‚ˆã†ã«
5. **å®Ÿç”¨çš„ãªã‚¢ãƒ‰ãƒã‚¤ã‚¹**: æ¬¡ã®ç·´ç¿’ã§å®Ÿè·µã§ãã‚‹å…·ä½“çš„ãªå†…å®¹

ãã‚Œã§ã¯ã€ã¾ã¨ã‚ã‚’ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚
"""

    @staticmethod
    def generate_period_prompt(data: Dict[str, Any], period: str) -> str:
        """
        Generate prompt for period-based summary.

        Args:
            data: Collected memo data
            period: "recent" or "month"

        Returns:
            Prompt string for Gemini API
        """
        today = datetime.now().strftime('%Y-%m-%d')
        period_label = "ç›´è¿‘2é€±é–“" if period == "recent" else "éå»1ãƒ¶æœˆ"

        return f"""
ã‚ãªãŸã¯ãƒ†ãƒ‹ã‚¹ã‚³ãƒ¼ãƒã®ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã§ã™ã€‚
ä»¥ä¸‹ã®{period_label}ã®ãƒ†ãƒ‹ã‚¹ç·´ç¿’ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰ã€æœŸé–“åˆ¥ã¾ã¨ã‚ã‚’ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚

# ãƒ‡ãƒ¼ã‚¿

## ã“ã®æœŸé–“ã®æ°—ã¥ã
{SummaryPrompts._format_insights(data['insights'])}

## ã“ã®æœŸé–“ã®åçœç‚¹
{SummaryPrompts._format_reflections(data['reflections'])}

## ã‚¿ã‚°åˆ¥é›†è¨ˆ
{SummaryPrompts._format_tags(data['tags'])}

## æœŸé–“æƒ…å ±
- é–‹å§‹æ—¥: {data['date_range']['start']}
- çµ‚äº†æ—¥: {data['date_range']['end']}

# ã‚¿ã‚¹ã‚¯

{period_label}ã®ç·´ç¿’å†…å®¹ã‚’æ™‚ç³»åˆ—ã§æŒ¯ã‚Šè¿”ã‚Šã€æˆé•·ã‚’å®Ÿæ„Ÿã§ãã‚‹ã¾ã¨ã‚ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚

# å‡ºåŠ›å½¢å¼

```markdown
# {period_label}ã®ã¾ã¨ã‚

æœŸé–“: {data['date_range']['start']} ã€œ {data['date_range']['end']}
æœ€çµ‚æ›´æ–°: {today}

---

## ğŸ“ˆ ã“ã®æœŸé–“ã®æˆé•·

ã“ã®æœŸé–“ã§æˆé•·ã—ãŸãƒã‚¤ãƒ³ãƒˆã‚’2-3å€‹æŒ™ã’ã¦ãã ã•ã„ã€‚
- å…·ä½“çš„ãªã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰ã‚’äº¤ãˆã¦
- ã€Œã§ãã‚‹ã‚ˆã†ã«ãªã£ãŸã“ã¨ã€ã‚’å¼·èª¿

ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ:
### [æˆé•·ãƒã‚¤ãƒ³ãƒˆ]

[è©³ç´°ãªèª¬æ˜ã¨å…·ä½“ä¾‹]

---

## ğŸ“… æ™‚ç³»åˆ—ã§ã®æŒ¯ã‚Šè¿”ã‚Š

ã“ã®æœŸé–“ã®æ°—ã¥ããƒ»åçœã‚’æ—¥ä»˜é †ã«ã¾ã¨ã‚ã¦ãã ã•ã„ã€‚

ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ:
### [æ—¥ä»˜]

#### âœ… æ°—ã¥ã
- [æ°—ã¥ãå†…å®¹]

#### âš ï¸ åçœç‚¹
- [åçœå†…å®¹]

ï¼ˆæ—¥ä»˜ã”ã¨ã«ç¹°ã‚Šè¿”ã—ï¼‰

---

## ğŸ¯ æ¬¡ã®æœŸé–“ã¸ã®èª²é¡Œ

ã“ã®æœŸé–“ã®åçœç‚¹ã‚’ã‚‚ã¨ã«ã€æ¬¡ã®æœŸé–“ï¼ˆ{period_label}ï¼‰ã§å–ã‚Šçµ„ã‚€ã¹ãèª²é¡Œã‚’3ã¤ææ¡ˆã—ã¦ãã ã•ã„ã€‚

ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ:
1. **[èª²é¡Œå]**
   - ç¾çŠ¶: [ã“ã®æœŸé–“ã®çŠ¶æ³]
   - ç›®æ¨™: [æ¬¡ã®æœŸé–“ã§é”æˆã—ãŸã„ã“ã¨]
   - å…·ä½“çš„ãªã‚¢ã‚¯ã‚·ãƒ§ãƒ³: [ä½•ã‚’ã™ã¹ãã‹]

---

## ğŸ“Š çµ±è¨ˆ

- ç·´ç¿’å›æ•°: [å›æ•°]
- æ°—ã¥ãä»¶æ•°: [ä»¶æ•°]
- åçœç‚¹ä»¶æ•°: [ä»¶æ•°]
- æœ€ã‚‚å¤šã‹ã£ãŸã‚¿ã‚°: [ã‚¿ã‚°å]ï¼ˆ[ä»¶æ•°]å›ï¼‰
```

# æ³¨æ„äº‹é …

1. **æˆé•·ã®å¯è¦–åŒ–**: å‰å‘ããªè¡¨ç¾ã§ã€æˆé•·ã‚’å®Ÿæ„Ÿã§ãã‚‹ã‚ˆã†ã«
2. **æ™‚ç³»åˆ—**: æ—¥ä»˜é †ã«ä¸¦ã¹ã‚‹ã“ã¨ã§ã€å¤‰åŒ–ã®æµã‚ŒãŒã‚ã‹ã‚‹ã‚ˆã†ã«
3. **æ¬¡ã¸ã®ç¹‹ãŒã‚Š**: éå»ã®æŒ¯ã‚Šè¿”ã‚Šã ã‘ã§ãªãã€æœªæ¥ã¸ã®æŒ‡é‡ã‚‚æç¤º
4. **å…·ä½“æ€§**: æŠ½è±¡çš„ã§ãªãã€å®Ÿè·µã§ãã‚‹å†…å®¹ã«

ãã‚Œã§ã¯ã€ã¾ã¨ã‚ã‚’ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚
"""

    # ========================================
    # Helper Methods
    # ========================================

    @staticmethod
    def _format_reflections(reflections: List[Dict[str, str]]) -> str:
        """
        Format reflections for prompt.

        Args:
            reflections: List of reflection dictionaries

        Returns:
            Formatted string
        """
        if not reflections:
            return "ï¼ˆåçœç‚¹ãªã—ï¼‰"

        lines = []
        for i, r in enumerate(reflections[:20], 1):  # Limit to 20
            status_mark = "[ ]" if r['status'] == 'unresolved' else "[x]"
            lines.append(f"{i}. {status_mark} {r['content']}")

        return "\n".join(lines)

    @staticmethod
    def _format_insights(insights: List[str]) -> str:
        """
        Format insights for prompt.

        Args:
            insights: List of insight strings

        Returns:
            Formatted string
        """
        if not insights:
            return "ï¼ˆæ°—ã¥ããªã—ï¼‰"

        lines = []
        for i, insight in enumerate(insights[:30], 1):  # Limit to 30
            lines.append(f"{i}. {insight}")

        return "\n".join(lines)

    @staticmethod
    def _format_tags(tags: Dict[str, int]) -> str:
        """
        Format tags for prompt.

        Args:
            tags: Dictionary of tag counts

        Returns:
            Formatted string
        """
        if not tags:
            return "ï¼ˆã‚¿ã‚°ãªã—ï¼‰"

        # Sort by count (descending)
        sorted_tags = sorted(tags.items(), key=lambda x: x[1], reverse=True)

        lines = []
        for tag, count in sorted_tags[:10]:  # Top 10
            lines.append(f"- {tag}: {count}å›")

        return "\n".join(lines)

    @staticmethod
    def _format_trends(trends: Dict[str, Any]) -> str:
        """
        Format trends for prompt.

        Args:
            trends: Trend analysis data

        Returns:
            Formatted string
        """
        if not trends:
            return "ï¼ˆãƒˆãƒ¬ãƒ³ãƒ‰ãƒ‡ãƒ¼ã‚¿ãªã—ï¼‰"

        lines = []

        # Practice frequency
        if 'practice_frequency' in trends:
            lines.append(f"ç·´ç¿’é »åº¦: {trends['practice_frequency']}")

        # Keywords
        if 'keywords' in trends and trends['keywords']:
            lines.append("\né »å‡ºã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰:")
            for keyword, count in list(trends['keywords'].items())[:5]:
                lines.append(f"- {keyword}: {count}å›")

        # Patterns
        if 'patterns' in trends and trends['patterns']:
            lines.append("\nãƒ‘ã‚¿ãƒ¼ãƒ³:")
            for pattern in trends['patterns'][:3]:
                lines.append(f"- {pattern}")

        return "\n".join(lines)
