# Phase 1: 基盤強化

## 概要

**目標:** 継続的に使える基本システムの構築

**期間:** 3-4週間

**効果:**
- 「サイクル」の実現
- 継続性の確保
- 柔軟な入力手段

---

## このフェーズの内容

| ドキュメント | 説明 |
|-------------|------|
| [input.md](input.md) | 入力機能（音声・テキスト・画像・動画・DM対応） |
| [processing.md](processing.md) | 処理機能（構造化・前回ログ関連付け） |
| [output.md](output.md) | 出力機能（Markdown・週次レビュー） |

---

## 完了条件

以下がすべて動作すること：

### 基本機能
- [ ] 各チャンネルで音声送信 → シーン別に保存
- [ ] テキストメッセージ → 構造化して保存
- [ ] 画像添付 → attachmentsフォルダに保存、Markdownに埋め込み
- [ ] 動画添付 → attachmentsフォルダに保存、Markdownに埋め込み
- [ ] Git LFS → 画像・動画が正しくトラッキングされている

### 振り返り機能
- [ ] #振り返りで追記可能
- [ ] 練習開始時にリマインド受信
- [ ] 週次レビューが自動生成される

### バックアップ対応
- [ ] Bot停止中にDMで送信 → 復旧後に自動処理
- [ ] 処理済みメッセージに✅リアクション

---

## タスク一覧

### 1. チャンネル分けの実装

**タスク:**
- [ ] Discordサーバーにチャンネル作成
  - `#壁打ち`
  - `#スクール`
  - `#試合`
  - `#フリー練習`
  - `#振り返り`
  - `#週次レビュー`
- [ ] チャンネル名からシーンを判定する関数
- [ ] テスト: 各チャンネルで音声送信

**実装ファイル:** `src/bot/channel_handler.py`

**詳細:** [input.md](input.md)

---

### 2. シーン別テンプレートの実装

**タスク:**
- [ ] 壁打ち用プロンプト作成
- [ ] スクール用プロンプト作成
- [ ] 試合用プロンプト作成
- [ ] Markdownテンプレート作成（各シーン）
- [ ] シーン別の構造化データ抽出関数
- [ ] テスト: 各シーンで正しく構造化されるか

**実装ファイル:**
- `src/ai/prompts.py`
- `src/ai/structured_extraction.py`
- `src/storage/markdown_templates.py`

**詳細:** [processing.md](processing.md)

---

### 3. テキストメモ機能

**タスク:**
- [ ] テキストメッセージの受信処理実装
- [ ] URL検出機能実装
- [ ] テキスト構造化プロンプト作成
- [ ] テキストメモのMarkdown生成
- [ ] テスト: URL付きテキストが正しく保存されるか

**詳細:** [input.md](input.md)

---

### 4. 画像メモ機能

**タスク:**
- [ ] 画像メッセージの受信処理実装
- [ ] ファイルサイズチェック（20MB以下）
- [ ] attachmentsフォルダへのファイル保存
- [ ] 画像のMarkdown埋め込み
- [ ] ユーザーコメントの記録（解析なし）
- [ ] テスト: 画像が正しく保存されるか

**詳細:** [input.md](input.md)

---

### 5. 動画メモ機能

**タスク:**
- [ ] 動画メッセージの受信処理実装
- [ ] ファイルサイズチェック（20MB以下）
- [ ] attachmentsフォルダへのファイル保存
- [ ] 動画のMarkdown埋め込み
- [ ] ユーザーコメントの記録（解析なし）
- [ ] テスト: 動画が正しく保存されるか

**詳細:** [input.md](input.md)

---

### 6. Git LFSのセットアップ

**タスク:**
- [ ] Raspberry PiにGit LFSをインストール
- [ ] .gitattributesの設定
- [ ] 画像・動画ファイルのトラッキング設定
- [ ] テスト: 大きなファイルがLFS経由でPushされるか

**詳細:** [../../setup/03-raspberry-pi.md](../../setup/03-raspberry-pi.md)

---

### 7. 前回ログの読み込み

**タスク:**
- [ ] ObsidianManagerの実装
- [ ] 最新メモを取得する関数（ファイル名ベース）
- [ ] シーン別の最新メモを取得する関数
- [ ] 前回との関連性を判定する関数
- [ ] テスト: 前回メモが正しく取得されるか

**詳細:** [processing.md](processing.md)

---

### 8. #振り返りチャンネル（追記機能）

**タスク:**
- [ ] 日付検出ロジック実装
- [ ] キーワード検出ロジック実装
- [ ] メモ検索機能実装
- [ ] 複数候補の場合、ボタンで選択
- [ ] 追記セクションをMarkdownに追加
- [ ] テスト: 正しいメモに追記されるか

**詳細:** [input.md](input.md)

---

### 9. 練習開始時のリマインド

**タスク:**
- [ ] ユーザーの練習スケジュールを記録
- [ ] 練習時刻にリマインド送信
- [ ] 前回の課題を含めたメッセージ生成
- [ ] Discord DMで送信
- [ ] テスト: リマインドが正しく送信されるか

**詳細:** [output.md](output.md)

---

### 10. 週次レビュー自動生成

**タスク:**
- [ ] 今週のメモを集計する関数
- [ ] 統計を計算する関数
- [ ] 頻出キーワードを抽出する関数
- [ ] 改善した課題を分析する関数
- [ ] 週次レビューMarkdownテンプレート
- [ ] 毎週日曜日21時に自動実行（APScheduler）
- [ ] #週次レビューチャンネルに投稿
- [ ] テスト: 週次レビューが正しく生成されるか

**詳細:** [output.md](output.md)

---

### 11. Discord DM処理（Bot停止時対応）

**タスク:**
- [ ] Bot起動時の未処理DMチェック機能実装
- [ ] 処理済みマーク（✅リアクション）の実装
- [ ] テキストからシーン抽出機能実装
- [ ] 未処理メモの自動処理
- [ ] 完了通知のDM送信
- [ ] .envにADMIN_USER_ID設定追加
- [ ] テスト: Bot停止中に送ったDMが復旧後に処理されるか

**詳細:** [input.md](input.md)

---

## 次のフェーズ

Phase 1が完了したら → [Phase 2: 対話の深化](../02-dialogue/index.md)
