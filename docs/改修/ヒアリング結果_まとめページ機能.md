# ヒアリング結果サマリー: まとめページ機能

**作成日**: 2025-12-08
**ヒアリング形式**: 課題探索型（ヒアリングエージェント v0.2.1）

---

## 📌 根本課題

### 現状の問題
- **個別メモファイルの閲覧が面倒**: 1メモ = 1ファイルで、複数ページを送って見るのが手間
- **過去の気づきが活用されていない**: Obsidianの個別ファイルをほとんど見ていない
- **練習前に確認する習慣がない**: まとまった形で見られないため、振り返りが習慣化していない

### ユーザーの声
> 「個別のメモファイルはほとんど見ていません。理由としては、1つのメモが1つの記事になっており、複数の記事をページを送って見るというのが手間で、あまり見る気にならないからです。」

---

## 🎯 達成したい成果

### 理想の状態
- **練習前に「今までの気づき」を効率よく確認できる**
- **テーマ別に整理されたまとめページ**で一覧性を向上
- **受動的にコツを受け取れる**仕組み（自主的に取りに行く必要がない）

### ユーザーストーリー
> 「練習が始まる前に、今まで自分の気づいたことを確認して再確認したいという気持ちがあります。まとめの理想の形はやはりテーマ別の整理がされていると良いかなと思います。」

---

## 📋 機能スコープ

### Must Have（必須機能）

#### 1. まとめページ自動生成（6種類）

**生成されるファイル**:
1. **まとめ_総合.md** - 練習前チェック用（最重要）
   - 未解決の反省点
   - 最近うまくいっていること
   - 最近のトレンド分析
   - 詳細まとめへのリンク

2. **まとめ_最近.md** - 直近2週間の詳細
3. **まとめ_1ヶ月.md** - 過去1ヶ月の詳細
4. **まとめ_フォアハンド.md** - 技術別（フォアハンド全記録）
5. **まとめ_バックハンド.md** - 技術別（バックハンド全記録）
6. **まとめ_サーブ.md** - 技術別（サーブ全記録）

**更新タイミング**:
- ✅ メモが入力された日 = 練習日（自動判定）
- ✅ 練習日の翌日朝に自動更新
- ✅ スケジューラーで毎日チェック、新規メモがあれば生成

---

#### 2. テーマ別整理（タグ付けシステム）

**技術別タグ（必須）**:
- `#フォアハンド` `#バックハンド` `#サーブ` `#ボレー` `#スマッシュ`

**ショット種別タグ**:
- `#強打` `#丁寧` `#スライス` `#スピン` `#フラット`

**タグ付け方法**:
- ✅ **AI自動判定**（手動入力は手間がかかるため不要）
- ✅ メモ内容から技術とショット種別を抽出
- ⚠️ タグ修正機能（後で検討、まずは精度確認）

**周辺情報の保存**:
- ✅ **対比**: 「強打しようとすると逆に入らない」（エラーパターン）
- ✅ **深堀り情報**: 質問への回答も含めて保存
- ✅ 気づきを「より強固にする周囲を固める文面」として記録

---

#### 3. 反省点と気づきの管理

**自動振り分け**:
- ✅ 同じ内容が「反省」と「気づき」の両方に入ることがある
  - 例: 「膝を曲げると安定」（気づき）
  - 例: 「膝を曲げないで打ったのはダメだった」（反省）
- ✅ AIが自動で判定して振り分け

**反省点の解決判定**:
- ✅ **明示的入力のみ解決とする**
  - 「〇〇は解決した」と入力した場合のみ
  - AI自動判定や期間経過では解決としない
- ✅ 未解決の反省点のみ練習前に表示
- ✅ 解決済みは表示しない（まとめページから除外）

**ユーザーの意図**:
> 「反省点の解決に関しては、なかなか1回で解決されるようなものではないと思います。一度更新を入れますが、以前の反省点なども時々思い出したかのように一度出力してもらえると、仮に解決したと自分の方から入力した場合でも見直しができて良いのではないかなと思います。」

---

#### 4. Discord連携（自動投稿）

**練習前リマインド**（練習日の朝8時）:
```
おはようございます！今日の練習前チェックです。

🚨 今日意識すること:
・フォアハンド: 振り遅れ → 早めの準備を徹底
・サーブ: トスの位置 → 毎回確認

📊 最近のトレンド:
・「早めの準備」が3回 → 継続しましょう
・「力みすぎ」の反省が2回 → リラックスを意識

詳細: [まとめ_総合.md へのリンク]
```

**1日1回のコツ投稿**（毎朝8時）:
```
📌 今日のコツ【フォアハンド編】

12/3のメモより:
「丁寧に打つ時はグリップを少し薄くすると
 コントロールしやすくなる」

💡 対比: 強打する時は厚めのグリップで
💡 根拠: 薄くすることで面の調整がしやすくなる
```

**ユーザーの意図**:
> 「Twitterのように『1日1回、今日はフォアハンドのコツを思い出してみましょう』ということで、今までのまとめで有用と思われる点をBotのように話しかけてくれると、都度思い出すことができて良いのではないかなと思います。自主的にコツを取りに行くというのは、多分しないと思うので、受動的にコツを伝えてくれるといいかなと思います。」

---

#### 5. 入力時の深堀り機能

**気づき入力直後の自動質問**:
```
あなた: （音声）「フラットで当てると良い」

Bot: 記録しました！📝

💡 深堀り（任意、スキップ可）:

1️⃣ 対比: フラット以外（スピン・スライス）で当てるとどうなる？
2️⃣ 変化: 以前はどんな当て方をしていた？
3️⃣ 根拠: なぜそのことに気づいた？
4️⃣ 具体化: どこをどう変えた？

（ボタンで回答 or スキップ）
```

**質問生成パターン**:
- ✅ **対比**: 「〇〇以外だとどうなる？」
- ✅ **変化**: 「以前はどうだった？」
- ✅ **根拠**: 「なぜそう気づいた？」
- ✅ **具体化**: 「どこをどう変えた？」

**タイミング**:
- ✅ 気づき入力直後
- ✅ スクール練習後: 記憶が鮮明な時に深堀り
- ✅ 壁打ち練習中: その場で試してテスト可能

**ユーザーの声**:
> 「『フラットで当てると良い』というコツを出したときには、『フラット以外にスピンやスライスで当てるとどうなる？』『いや、以前はどうだった？』『なぜそのことに気づいた？』など、そのコツをしっかり取り入れるための周囲を固めるような質問をしてもらえると、よりその気づきが明確になるのではないかなと思います。」

---

### Nice to Have（あれば嬉しい）

#### 1. Discordコマンド
- `/まとめ更新` - まとめページを即座に再生成
- `/まとめ` - 総合まとめをDiscordに表示（要約版）
- `/コツ [技術名]` - 特定技術のコツを表示

※コマンドの種類は後で検討（最小限から開始）

#### 2. タグ修正機能
- Obsidianで手動編集（YAML frontmatter）
- Discordコマンドで修正
- 定期的に「タグ確認」を自動実行

※まずは自動タグの精度を確認してから、修正機能の必要性を判断

---

### Out of Scope（対象外）

#### 1. 感覚別の整理
- 「シュッとした感じ」「ガツンと当たる」などの感覚別タグは不要
- 技術別・ショット種別で十分

#### 2. 時系列リスト
- 「12/1: 〇〇に気づいた、12/5: △△に気づいた」のような単純な時系列は不要
- テーマ別整理を優先

#### 3. AI自動判定による反省点の解決
- AIが「今日はうまくできた」から自動で解決判定は不要
- 明示的な入力のみで解決とする

---

## 🗂️ まとめ_総合.md の構成（詳細）

```markdown
# テニス練習まとめ（総合）

最終更新: 2025-12-07

---

## 🚨 練習前チェック

### 今日意識すること（未解決の反省点）
- [ ] フォアハンド: 振り遅れが多かった → 早めの準備を徹底
- [ ] サーブ: トスが安定しない → トスの位置を毎回確認

### 最近うまくいっていること
- ✅ バックハンド・スライス: 面を立てて切る
- ✅ フォアハンド・丁寧: グリップを薄く

---

## 📊 最近のトレンド（過去2週間）

### 頻出キーワード
- 「早めの準備」が3回 → 意識できている証拠、継続しましょう
- 「力みすぎ」の反省が2回 → 今週はリラックスを意識

### 技術別の気づき頻度
- フォアハンド: 5件
- バックハンド: 3件
- サーブ: 2件

---

## 📚 詳細まとめへのリンク

### 期間別
- [[まとめ_最近]] - 直近2週間の詳細
- [[まとめ_1ヶ月]] - 過去1ヶ月の詳細

### 技術別
- [[まとめ_フォアハンド]] - フォアハンド全記録
- [[まとめ_バックハンド]] - バックハンド全記録
- [[まとめ_サーブ]] - サーブ全記録
```

---

## 🗂️ まとめ_フォアハンド.md の構成例

```markdown
# フォアハンドまとめ

最終更新: 2025-12-07

---

## 🎾 強打（ドライブ）

### 気づき
- **振り抜くイメージで**（12/1）
  - 💡 対比: 当てるだけだとスピードが出ない
  - 💡 根拠: フォロースルーを大きくすることで遠心力が使える

- **体重移動を意識**（12/5）
  - 💡 対比: 手打ちになると力が伝わらない
  - 💡 具体化: 後ろ足から前足に体重を乗せる

### 反省点
- [ ] 振り遅れが多い（12/1、12/6） ← 繰り返し発生
  - 原因: テイクバックが遅い
  - 対策: 早めの準備を徹底

---

## 🎾 丁寧（コントロール重視）

### 気づき
- **グリップを少し薄く**（12/3）
  - 💡 対比: 厚いグリップだと面の調整が難しい
  - 💡 根拠: 薄くすることで微調整がしやすい

- **フォロースルーを長めに**（12/7）
  - 💡 対比: 短いと方向が安定しない
  - 💡 具体化: ターゲット方向に長く押し出す

---

## 🎾 スライス

### 気づき
- **面を立てて切る**（12/4）
  - 💡 対比: 寝かせると浮いてしまう
  - 💡 具体化: ラケット面を垂直に近い角度で

---

## 📊 統計

- 強打の気づき: 5件
- 丁寧打ちの気づき: 3件
- スライスの気づき: 1件
- 未解決の反省点: 1件
```

---

## 🔧 技術要件

### 実装モジュール

#### 新規作成
1. **`src/storage/summary_generator.py`** - まとめページ生成エンジン
   - `generate_summary_overview()` - 総合まとめ生成
   - `generate_summary_recent()` - 最近のまとめ生成
   - `generate_summary_by_period()` - 期間別まとめ生成
   - `generate_summary_by_technique()` - 技術別まとめ生成

2. **`src/ai/tag_extraction.py`** - AI自動タグ付け
   - `extract_tags_from_memo()` - メモからタグを抽出
   - `extract_technique_tags()` - 技術別タグ
   - `extract_shot_type_tags()` - ショット種別タグ

3. **`src/ai/deepening_questions.py`** - 深堀り質問生成
   - `generate_deepening_questions()` - 気づきから質問を生成
   - パターン: 対比、変化、根拠、具体化

4. **`src/scheduler/daily_tips.py`** - 1日1回のコツ投稿
   - `post_daily_tip()` - ランダムにコツを選択して投稿
   - 対比・根拠なども含めて表示

5. **`src/analysis/reflection_manager.py`** - 反省点管理
   - `mark_reflection_as_resolved()` - 反省点を解決済みに
   - `get_unresolved_reflections()` - 未解決の反省点を取得

#### 既存ファイル更新
1. **`src/bot/handlers/message_handler.py`**
   - 深堀りボタンインターフェースの統合
   - メモ保存後に深堀り質問を自動表示

2. **`src/scheduler/scheduler_manager.py`**
   - 練習前リマインド（練習日の朝8時）
   - 1日1回のコツ投稿（毎朝8時）
   - まとめページ更新チェック（毎日深夜）

3. **`src/storage/obsidian_manager.py`**
   - タグフィルタリング機能の強化
   - まとめページ用のメモ抽出機能

---

### スケジューラー設定

| タイミング | 処理内容 | 条件 |
|----------|---------|-----|
| 毎朝8時 | 練習前リマインド | 練習日（前日にメモがあれば） |
| 毎朝8時 | 1日1回のコツ投稿 | 毎日 |
| 毎日深夜（3時） | まとめページ更新チェック | 前日にメモがあれば生成 |

---

### データ構造

#### メモのYAML frontmatter（拡張）
```yaml
---
date: 2025-12-07
scene: 壁打ち
tags:
  - フォアハンド
  - 強打
  - 丁寧
insights:
  - content: "グリップを薄くすると安定"
    contrast: "厚いと面の調整が難しい"
    reason: "薄くすることで微調整がしやすい"
reflections:
  - content: "振り遅れが多かった"
    status: unresolved
    first_occurred: 2025-12-01
---
```

---

## 🎨 ビジョン

### 短期的なビジョン（3ヶ月）
- ✅ 練習前に「まとめ_総合.md」を開く習慣が定着
- ✅ 1日1回のコツ投稿で、無意識に復習できる
- ✅ 反省点が明確になり、練習の質が向上

### 中期的なビジョン（6ヶ月）
- ✅ 技術別まとめで、各技術の進化が可視化される
- ✅ 深堀り機能で、気づきの質が向上
- ✅ 過去のメモが「資産」として活用される

### 長期的なビジョン（1年）
- ✅ AIが最適なアドバイスを提案できるほど、データが蓄積される
- ✅ 「第2の脳」として、自律的な上達サイクルが確立
- ✅ テニス以外のドメインにも転用可能な「知識管理システム」に進化

---

## 📝 設計判断の背景

### 1. なぜ「明示的入力のみ」で反省点を解決とするのか？

**理由**:
- テニスの技術習得は「1回で解決されるものではない」
- AI自動判定だと誤検知の可能性がある
- ユーザー自身が「解決した」と実感した時に明示することで、確実性を担保

**ユーザーの意図**:
> 「反省点の解決に関しては、なかなか1回で解決されるようなものではないと思います。」

---

### 2. なぜ「AI自動タグ付け」なのか？

**理由**:
- 手動タグ付けは「非常に手間がかかる」（ユーザーの声）
- 音声入力がメインのため、手動タグ付けは現実的でない
- まずはAI精度を確認し、必要に応じて修正機能を追加する方針

---

### 3. なぜ「受動的なコツ投稿」なのか？

**理由**:
- 「自主的にコツを取りに行くというのは、多分しない」（ユーザーの声）
- 習慣化には「受動的に受け取る」仕組みが効果的
- Twitterのような「1日1回」の投稿で、無意識に復習できる

---

### 4. なぜ「6種類のまとめページ」を全部実装するのか？

**理由**:
- 「まとめもどういう形がベストかわかっていない」（ユーザーの声）
- 複数タイプを実装して、実際に使ってみてフィードバックを得る
- 最適な形を見つけるための「実験的アプローチ」

**ユーザーの意図**:
> 「色んなタイプのまとめを実装して、あとでフィードバックしたいなと思います。」

---

## 🚀 次のステップ

### Phase 1: コア機能実装
1. まとめページ生成エンジン（6種類）
2. AI自動タグ付け
3. 反省点管理（解決判定）

### Phase 2: Discord連携
1. 練習前リマインド（自動投稿）
2. 1日1回のコツ投稿（自動投稿）
3. スケジューラー統合

### Phase 3: 深堀り機能
1. 深堀り質問生成
2. ボタンインターフェース統合
3. 周辺情報の保存

### Phase 4: テスト＆フィードバック
1. 実環境でのテスト
2. ユーザーフィードバック収集
3. 調整・改善

---

## 📚 参考資料

- **ヒアリングエージェント仕様書**: v0.2.1（課題探索型）
- **既存ドキュメント**:
  - `docs/ガイド/機能一覧.md` - 既存機能の全体像
  - `docs/ガイド/アーキテクチャ.md` - システム構成
  - `docs/plan.md` - Phase 1-4の実装状況
- **既存実装**:
  - `src/bot/action_buttons.py` - ボタンインターフェース（Phase 2完了）
  - `src/ai/question_generation.py` - ソクラテス式質問生成（Phase 2完了）
  - `src/scheduler/scheduler_manager.py` - スケジューラー管理（Phase 1完了）

---

**最終更新**: 2025-12-08
**次回レビュー**: 実装開始後、各Phase完了時
