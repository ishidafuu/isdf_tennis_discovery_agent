# Phase 2: 対話の深化

## 概要

**目標:** ソクラテス式問答の実装

**期間:** 2-3週間

**効果:**
- 気づきを深める対話
- AIによる自動判断
- 過去との比較・分析

---

## このフェーズの内容

| ドキュメント | 説明 |
|-------------|------|
| [features.md](features.md) | 対話深化の機能詳細 |

---

## 主要機能

### 1. AIの自動判断

AIが以下を自動判断：

- **そのまま保存でOK**: 日常的なメモ、特に深掘り不要
- **深堀質問すべき**: 新しい気づき、曖昧な表現
- **過去と比較すべき**: 過去に似たテーマがある

### 2. 深堀質問の生成

**ソクラテス式問答**で気づきを促す：

| パターン | 質問例 |
|---------|--------|
| **理由を聞く** | 「なぜそう思ったんですか？」 |
| **具体化を促す** | 「『うまくいった』とは、具体的にどういう感覚ですか？」 |
| **他の可能性** | 「他に試せることはありますか？」 |
| **次のアクション** | 「次回も同じように意識しますか？」 |
| **過去との違い** | 「前回と何が違いましたか？」 |

### 3. オプションボタンUI

```
Bot: 「スクールでのメモを保存しました！」

[深堀り質問] [過去と比較] [そのまま終了]
```

### 4. 過去との比較

- 類似メモの検索
- 成長の可視化
- パターンの発見

### 5. 矛盾の指摘

- 考えの変化に気づかせる
- 一貫性の確認
- 意図的な変化か、無意識か確認

### 6. ナレッジ統合（基本）

- #質問チャンネルの実装
- キーワード検索 + RAG

---

## 完了条件

以下がすべて動作すること：

### AI自動判断
- [ ] メモの内容を分析して判断
- [ ] 自信度に基づいてアクションを選択
- [ ] 判断結果をログに記録

### 深堀機能
- [ ] 追加質問を自動生成
- [ ] 複数ターンの会話（最大3ターン）
- [ ] スキップ・タイムアウト対応

### ボタンUI
- [ ] Discordボタンが表示される
- [ ] ボタン押下で適切なアクションが実行される
- [ ] タイムアウト処理

### 比較・分析
- [ ] 類似メモの検索が動作
- [ ] 比較分析の結果が適切
- [ ] 矛盾検出が機能

---

## タスク一覧

### 1. AIの自動判断ロジック

**タスク:**
- [ ] 判断プロンプトの作成
- [ ] 自信度の閾値設定
- [ ] フォールバック処理

**実装ファイル:** `src/ai/auto_decision.py`

---

### 2. 深堀質問の生成

**タスク:**
- [ ] ソクラテス式質問プロンプト作成
- [ ] 質問パターンのバリエーション
- [ ] 複数ターン会話の管理

**実装ファイル:** `src/ai/question_generation.py`

---

### 3. ボタンUI実装

**タスク:**
- [ ] Discordボタンコンポーネント作成
- [ ] ボタンハンドラーの実装
- [ ] タイムアウト処理

**実装ファイル:** `src/bot/action_buttons.py`

---

### 4. 過去と比較機能

**タスク:**
- [ ] 類似メモ検索機能
- [ ] 比較分析プロンプト作成
- [ ] 比較結果の表示

**実装ファイル:** `src/analysis/comparison.py`

---

### 5. 矛盾検出機能

**タスク:**
- [ ] 矛盾検出プロンプト作成
- [ ] 変化の指摘メッセージ生成
- [ ] ユーザーへの確認フロー

**実装ファイル:** `src/analysis/contradiction_detection.py`

---

### 6. #質問チャンネルの実装

**タスク:**
- [ ] チャンネルハンドラーの追加
- [ ] キーワード検索機能
- [ ] RAGによる回答生成

**実装ファイル:** `src/bot/channel_handler.py`

---

## 次のフェーズ

Phase 2が完了したら → [Phase 3: データ活用](../03-data-utilization/index.md)
