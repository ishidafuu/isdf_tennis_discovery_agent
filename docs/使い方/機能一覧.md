# Tennis Discovery Agent - 機能一覧

最終更新: 2025-12-12

このドキュメントでは、Tennis Discovery Agentの全機能を一覧で紹介します。

---

## 📋 目次

- [概要](#概要)
- [基本機能](#基本機能)
- [対話機能](#対話機能)
- [分析・検索機能](#分析検索機能)
- [自動化機能](#自動化機能)
- [ストレージ・同期機能](#ストレージ同期機能)

---

## 概要

Tennis Discovery Agentは、テニス練習の記録・分析・振り返りを支援するDiscord Botです。

**主要コンポーネント:**

| コンポーネント | 役割 |
|--------------|------|
| Discord Bot | ユーザーインターフェース（音声・テキスト・画像・動画の受付） |
| Gemini AI | 音声文字起こし・構造化抽出・分析・質問回答 |
| Obsidian Vault | Markdown形式でのデータ保存（ローカル） |
| GitHub | バージョン管理・クラウドバックアップ |

---

## 基本機能

### 1. 音声メモ記録

**機能概要:** Discordの音声メッセージを自動で文字起こしし、構造化された練習記録を生成

**処理フロー:**
1. Discord音声メッセージを受信
2. Gemini AIで文字起こし
3. 構造化データ抽出（気づき、反省点、次回テーマなど）
4. Markdown形式でObsidianに保存
5. GitHubにプッシュ

**対応フォーマット:**

| 形式 | 拡張子 | サイズ制限 |
|-----|-------|----------|
| Ogg Opus | `.ogg`, `.opus` | 20MB |
| MP3 | `.mp3` | 20MB |
| WAV | `.wav` | 20MB |
| M4A | `.m4a` | 20MB |
| WebM | `.webm` | 20MB |

**抽出される情報:**
- 今日の焦点（何を意識したか）
- 身体感覚の気づき
- 成功パターン
- 失敗パターン
- コーチからのアドバイス（スクールの場合）
- 次回のテーマ

---

### 2. テキストメモ記録

**機能概要:** テキストメッセージから構造化された練習記録を生成

**制限:**
- 最低10文字以上のメッセージが必要
- コマンド（`!`で始まるメッセージ）は除外

**処理:** 音声メモと同様に構造化抽出・保存

---

### 3. 画像メモ記録

**機能概要:** 画像ファイルを練習記録として保存

**対応フォーマット:**

| 形式 | 拡張子 | サイズ制限 |
|-----|-------|----------|
| JPEG | `.jpg`, `.jpeg` | 20MB |
| PNG | `.png` | 20MB |
| GIF | `.gif` | 20MB |

**保存先:** `attachments/{date}/YYYY-MM-DD_シーン名_HHMMSS.ext`

**特徴:**
- Git LFSで管理（大容量ファイル対応）
- Obsidianの埋め込み形式（`![[filepath]]`）で保存
- 添付時のコメントも一緒に記録

---

### 4. 動画メモ記録

**機能概要:** 動画ファイルを練習記録として保存

**対応フォーマット:**

| 形式 | 拡張子 | サイズ制限 |
|-----|-------|----------|
| MP4 | `.mp4` | 20MB |
| MOV | `.mov` | 20MB |
| AVI | `.avi` | 20MB |
| WebM | `.webm` | 20MB |

**保存先:** 画像メモと同様

---

### 5. シーン別記録

**機能概要:** チャンネル名からシーン（練習種別）を自動判定

**対応シーン:**

| シーン | チャンネル名 | 特徴 |
|-------|------------|------|
| 壁打ち | `#壁打ち`, `#wall`, `#wall-practice` | 基礎練習・反復ドリル向けの抽出 |
| スクール | `#スクール`, `#school`, `#lesson` | コーチ指導・フィードバック重視の抽出 |
| 試合 | `#試合`, `#match`, `#game` | 戦術・スコア・メンタル重視の抽出 |
| フリー練習 | `#フリー練習`, `#free`, `#free-practice` | 汎用的な気づき抽出 |

---

### 6. サイクル管理

**機能概要:** 「前回 → 今回 → 次回」の連続性を自動管理

**処理:**
1. 同一シーンの最新メモを自動取得
2. 前回の「次回テーマ」を今回の入力と照合
3. Discord応答に「🔄 サイクル」セクションを表示
4. 今回の「次回テーマ」を次回の参照用に保存

**効果:**
- 毎回の練習が「線」でつながる
- 前回の課題を意識した練習が可能
- 成長の軌跡が可視化される

---

## 対話機能

### 7. アクションボタン

**機能概要:** 音声メモ送信後、追加のアクションを選択できるUI

**ボタン一覧:**

| ボタン | 絵文字 | 機能 |
|-------|-------|------|
| 深堀り質問 | 🤔 | AIが追加の深掘り質問を生成 |
| 過去と比較 | 📊 | 類似の過去メモと比較分析 |
| そのまま終了 | ✅ | 現在の内容で記録を確定 |

**タイムアウト:** 60秒（経過後は自動的に保存）

---

### 8. 確認ダイアログ

**機能概要:** 重要な操作で確認を求めるUI

**ボタン一覧:**

| ボタン | 絵文字 | 機能 |
|-------|-------|------|
| はい | ✅ | 確認・実行 |
| いいえ | ❌ | キャンセル |

**タイムアウト:** 30秒（経過後はキャンセル扱い）

---

### 9. 深掘り質問生成

**機能概要:** メモ内容をもとに、より深い気づきを引き出す質問を生成

**質問の種類:**
- 身体感覚に関する質問（「その時、身体のどこを意識していましたか？」）
- 対比に関する質問（「以前と比べてどう変わりましたか？」）
- 根拠に関する質問（「なぜそう思いましたか？」）
- 具体化に関する質問（「具体的にはどのような場面でしたか？」）

---

### 10. 過去メモ比較

**機能概要:** 今回のメモと類似の過去メモを比較分析

**処理:**
1. キーワード抽出
2. 類似メモ検索
3. AI比較分析
4. 成長・変化のポイントを表示

---

## 分析・検索機能

### 11. 振り返りチャンネル

**機能概要:** 過去のメモに追記・補足を追加

**チャンネル:** `#振り返り`, `#reflection`, `#review`

**使い方:**
1. 日付やキーワードを含めてメッセージを送信
2. ボットがあいまい検索で関連メモを特定
3. 最もマッチしたメモに追記

**対応する日付表現:**

| 表現 | 例 |
|-----|---|
| 完全日付 | `2025/11/27`, `2025-11-27` |
| 短縮日付 | `11/27`（当年を仮定） |
| 相対日付 | `昨日`, `一昨日`, `3日前` |

---

### 12. 質問チャンネル

**機能概要:** 過去の記録を検索して質問に回答

**チャンネル:** `#質問`, `#question`, `#qa`

**処理:**
1. 質問からキーワードを抽出
2. キーワードで過去メモを検索
3. 関連メモをもとにAIが回答を生成
4. 参照したメモのリストも表示

**回答の特徴:**
- 過去の成功体験を引用
- アドバイスではなく、自分自身の気づきを思い出させる
- 次のアクションを質問形式で促す

---

### 13. 分析チャンネル

**機能概要:** 期間を指定してAI分析レポートを生成

**チャンネル:** `#分析`, `#analysis`, `#analytics`

**対応する期間表現:**

| 表現 | 対象期間 |
|-----|---------|
| `今週`, `this week` | 7日間 |
| `今月`, `this month` | 30日間 |
| `3ヶ月`, `three months` | 90日間 |
| `半年`, `six months` | 180日間 |
| `1年`, `year` | 365日間 |

**分析項目:**
1. 改善した点
2. 継続中の課題
3. 頻繁に出てくるテーマ
4. 次に取り組むべきこと
5. 全体的な評価とアドバイス

---

## 自動化機能

### 14. 週次レビュー自動生成

**機能概要:** 毎週自動で週次レビューを生成

**実行タイミング:** 毎週日曜日 21:00

**生成内容:**
- 今週の練習回数
- 主な気づきのまとめ
- 課題の進捗
- 来週への提案

**通知:** 管理者にDMで通知（`ADMIN_USER_ID`環境変数で設定）

---

### 15. まとめページ自動生成

**機能概要:** 練習記録から6種類のまとめページを自動生成

**実行タイミング:** 毎日 3:00 AM（前日にメモが追加された場合のみ）

**生成されるページ:**

| ページ名 | 内容 |
|---------|------|
| `まとめ_総合.md` | 練習前チェック用の総合まとめ |
| `まとめ_最近.md` | 直近2週間の詳細 |
| `まとめ_1ヶ月.md` | 過去1ヶ月の詳細 |
| `まとめ_フォアハンド.md` | フォアハンド全記録 |
| `まとめ_バックハンド.md` | バックハンド全記録 |
| `まとめ_サーブ.md` | サーブ全記録 |

**まとめ_総合.mdの内容:**
- 今日意識すること（未解決の反省点）
- 最近うまくいっていること
- 最近のトレンド（頻出キーワード）
- 技術別の気づき頻度

---

### 16. 非アクティブリマインダー

**機能概要:** 練習記録がない日が続くと通知

**実行タイミング:** 毎日 20:00

**通知条件:** 3日間連続でメモの追加がない場合

**通知内容:** 管理者にDMでリマインド

---

## ストレージ・同期機能

### 17. Obsidian Vault保存

**機能概要:** 全ての記録をMarkdown形式で保存

**ファイル形式:**
- **メモファイル:** `YYYY-MM-DD-HHMMSS-シーン名.md`
- **添付ファイル:** `attachments/{date}/YYYY-MM-DD_シーン名_HHMMSS.ext`

**Markdownの構造:**
```yaml
---
date: 2025-11-27
scene: 壁打ち
tags:
  - フォアハンド
  - サーブ
---
```

```markdown
# 練習メモ - 壁打ち

## 今日の焦点
...

## 気づき
...

## 反省点
...

## 次回のテーマ
...
```

---

### 18. GitHub同期

**機能概要:** 全ての記録をGitHubにプッシュ

**タイミング:**
- メモ保存時に自動プッシュ
- まとめページ更新時に自動プッシュ

**Git LFS管理対象:**
- 画像: `.jpg`, `.jpeg`, `.png`, `.gif`
- 動画: `.mp4`, `.mov`, `.avi`, `.webm`
- 音声: `.ogg`, `.mp3`, `.wav`, `.m4a`, `.opus`

---

### 19. DM バックアップ

**機能概要:** Bot停止中に送信されたDMを起動時に処理

**処理:**
- Bot起動時に未処理のDMをチェック
- 保留中のメッセージを処理

---

## 関連ドキュメント

- **基本的な使い方:** [`基本的な使い方.md`](./基本的な使い方.md)
- **ストーリーガイド:** [`ストーリーガイド.md`](./ストーリーガイド.md)
- **コマンドリファレンス:** [`リファレンス/コマンド.md`](./リファレンス/コマンド.md)
- **セットアップ:** [`../../SETUP.md`](../../SETUP.md)

---

**Tennis Discovery Agentで、あなたのテニス上達を科学的にサポートします！🎾**
